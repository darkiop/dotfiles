#!/bin/bash

# enable fzf
# shellcheck source=/dev/null
case $- in
*i*) ;;
*) return ;;
esac

_dotfiles_add_to_path() {
	local dir="$1"
	[[ -d "$dir" ]] || return 0
	case ":${PATH:-}:" in
	*":${dir}:"*) return 0 ;;
	*) export PATH="${PATH:+${PATH}:}${dir}" ;;
	esac
}

# Ensure fzf is reachable even when installed via dotfiles submodule.
if command -v ADD_TO_PATH >/dev/null 2>&1; then
	ADD_TO_PATH "$HOME/.fzf/bin"
	ADD_TO_PATH "$HOME/dotfiles/modules/fzf/bin"
else
	_dotfiles_add_to_path "$HOME/.fzf/bin"
	_dotfiles_add_to_path "$HOME/dotfiles/modules/fzf/bin"
fi

if ! command -v fzf >/dev/null 2>&1; then
	return 0
fi

if [[ -n ${ZSH_VERSION:-} ]]; then
	# Prefer the installer-generated init script if present.
	# `~/.fzf.bash` contains `eval "$(fzf --bash)"` and must not be sourced by zsh.
	if [[ -f ~/.fzf.zsh ]]; then
		source ~/.fzf.zsh
	fi

	# `eval "$(fzf --zsh)"` breaks because backslash-newline continuations in the
	# generated script are consumed by double-quote parsing before `eval` sees them.
	# Source the generated script instead to preserve its exact contents.
	source <(fzf --zsh 2>/dev/null) || true
else
	# bash
	if [[ -f ~/.fzf.bash ]]; then
		source ~/.fzf.bash
	fi

	# Same rationale as above: source the generated script to preserve continuations.
	source <(fzf --bash 2>/dev/null) || true
fi

# fzf (Fuzzy Finder) Options
export FZF_DEFAULT_OPTS='
--height 50% 
--layout=reverse-list 
--margin=0 
--padding=0 
--border=rounded 
--info=inline 
--ansi 
--color=bg+:#313244,bg:#1e1e2e,spinner:#f5e0dc,hl:#f38ba8 
--color=fg:#ffffff,header:#00afff,info:#00afff,pointer:#ff0000 
--color=marker:#ff0000,fg+:#00afff,prompt:#00afff,hl+:#ffffff
'

# fzf-bash-completion
# https://github.com/lincheney/fzf-tab-completion
#  if [[ -f ~/dotfiles/modules/fzf-tab-completion/bash/fzf-bash-completion.sh ]]; then
#   source ~/dotfiles/modules/fzf-tab-completion/bash/fzf-bash-completion.sh
#     bind -x '"\t": fzf_bash_completion'
#     #bind -x '"\C-f": fzf_bash_completion'
#  fi

# load fzf key bindungs
# if [[ -f /usr/share/doc/fzf/examples/key-bindings.bash ]]; then
#   source /usr/share/doc/fzf/examples/key-bindings.bash
# fi
